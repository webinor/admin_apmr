const display_pdf=e=>{for(let t=0;t<e.length;t++){const i=e[t];pdfjsLib.getDocument(i.link).promise.then((function(e){var t=i.page;e.getPage(t).then((function(e){const t=document.getElementById("file-previews-return");var i=e.getViewport({scale:5}),a=create_header(0),n=create_canvas(i),s=create_wrapper(i,5,0);s.appendChild(a),s.appendChild(n),t.appendChild(s);var d={canvasContext:n.getContext("2d"),viewport:i};e.render(d).promise.then((function(){setTimeout((()=>s.classList.add("animate")),0)}))}))}),(function(e){console.error(e)}))}};$(document).ready((function(){const e=document.getElementById("drag-drop-area");e.addEventListener("dragover",(t=>{t.preventDefault(),e.classList.add("drag-over")})),e.addEventListener("dragleave",(()=>{e.classList.remove("drag-over")})),e.addEventListener("drop",(t=>{t.preventDefault(),e.classList.remove("drag-over");!function(e){displayPreview(e)}(t.dataTransfer.files)}))}));var pdfjsLib=window["pdfjs-dist/build/pdf"];pdfjsLib.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.6.347/pdf.worker.min.js",$("#files").on("change",(function(e){const t=e.target.files;displayPreview(t)}));const displayPreview=e=>{$("#save_files_button").addClass("d-none"),$("#form-files .loader").removeClass("d-none");var t=0+$(".items-preview").length;for(const a of e)if("application/pdf"==a.type){var i=new FileReader;i.onload=function(){var e=new Uint8Array(this.result);pdfjsLib.getDocument({data:e}).promise.then((function(e){e.getPage(1).then((function(i){const n=document.getElementById("file-previews");var s=i.getViewport({scale:5}),d=create_header(t),r=create_canvas(s),l=create_wrapper(s,5,t),o=create_description(a,e);l.appendChild(d),l.appendChild(r),l.appendChild(o),n.appendChild(l),t+1==$(".items-preview").length&&($("#form-files .loader").addClass("d-none"),$("#save_files_button").removeClass("d-none")),setTimeout((()=>l.classList.add("animate")),500*t),t++;var c={canvasContext:r.getContext("2d"),viewport:s};i.render(c).promise.then((function(){}))}))}),(function(e){console.error(e)}))},i.readAsArrayBuffer(a)}};$(".additionnal_details").click((function(e){let t=$(this).closest("form").attr("id"),i=$(`#${t} .tab`).val(),a=$(`#${t} .list`).val(),n=$(`#${t} .instance`).val(),s=$(`#${t} .url`).val();add_details_request(t,i,a,s,n)}));const create_canvas=e=>{const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.style.width="85%",t.style.height="85%",t},create_wrapper=(e,t,i)=>{const a=document.createElement("div");return a.className="items-preview col-lg-2 mb-5",a.style.width=Math.floor(e.width/(2.5*t))+"pt",a.style.height=Math.floor(e.height/(2.5*t))+"pt",a},create_header=e=>$(`<div class="text-center">\n <a  class="show blink me-2" href="#"><i\nclass="menu-icon mdi mdi-eye"></i></a>\n\n<a  class="remove-file-from-list blink" data-index="${e}" href="#"><i\nclass="menu-icon mdi mdi-close-circle"></i></a>\n</div>`)[0],create_description=(e,t)=>{if(e){const i=document.createElement("div");return i.className="shadow card-body p-0 ps-2 fw-bold bg-white",i.style.width="85%",$(i).append(`<p class="p-0 mb-0 card-text">${e.name}</p>`),$(i).append(`<p class="p-0 mb-0 card-text">${t.numPages} Pages</p>`),i}},removeFileFromFileList=(e,t,i,a)=>{const n=new DataTransfer,s=document.getElementById("files"),{files:d}=s;for(let e=0;e<d.length;e++){const t=d[e];i!==e&&n.items.add(t)}document.getElementById("files").files=n.files,a.remove(),0==$(`#${t}  .items-preview`).length&&$(`#${e} #save_files_button`).addClass("d-none")};$("#file-previews, #file-previews-return").on("click",".remove-file-from-list",(function(e){var t=$(this).data("index"),i=$(this).closest(".items-preview");removeFileFromFileList("form-files","file-previews",t,i),e.preventDefault()}));const add_details_request=(e,t,i,a,n)=>{$(`#${e} .additionnal_details`).toggleClass("d-none"),$(`#${e} .loader`).toggleClass("d-none"),$(`#${t} .alert-success`).addClass("d-none");let s,d=`/api/${a}`,r=!0,l=!0;"form_input"==e?(s={},s=getInputValues(e,s)):(r=!1,l=!1,$(`#${e} #slug`).removeClass("is-invalid"),$(`#${e} #file`).removeClass("is-invalid"),s=new FormData,s=getInputValues(e,s,"form-control",!1),s=getFileValues(e,s,"file-input","files[]")),s.append("_token",$('meta[name="csrf-token"]').attr("content")),s.append("provider",$("#provider").val());ajaxRequest=constructAjaxRequest(d,s,(function(t,i,a){t.status?($("#overview .alert-success").removeClass("d-none"),$("#overview #save_files_button").addClass("d-none"),addCaseFile(t,"audiences"),$(`#${e}`)[0].reset(),$("#overview .items-preview").remove()):$.each(t.errors,(function(e,t){$(` #${e} `).siblings(".invalid-feedback").text(t[0]),$(` #${e} `).addClass("is-invalid")}))}),(function(e){if(422===e.status)$.each(e.responseJSON.errors,(function(e,t){$("#provider-input .invalid-feedback").text(t[0]),$(`#${e}`).addClass("is-invalid")}))}),(function(t,i){$(`#${e} .additionnal_details`).toggleClass("d-none"),$(`#${e} .loader`).toggleClass("d-none")}),"POST",r,l),sendAjaxRequest(ajaxRequest)},addCaseFile=(e,t="home")=>{$("#good"),$("#bad");display_pdf(e.pdf_links);var i=parseInt($("#badge-success").text())+e.slips.length;$("#badge-success").text(i),$("#home-tab").removeClass("active"),$("#home-tab").attr("aria-selected","false"),$($("#home-tab").attr("href")).removeClass("show"),$($("#home-tab").attr("href")).removeClass("active"),$("#profile-tab").addClass("active"),$("#profile-tab").attr("aria-selected","true"),$($("#profile-tab").attr("href")).addClass("show"),$($("#profile-tab").attr("href")).addClass("active"),fill_provider(t,e.slips[0].folders[0].provider),fill_finance(t,e.slips[0].folders[0].invoices),fill_beneficiary(t,e.slips[0].folders[0]),fill_invoice(t,e.slips[0].folders[0])},fill_provider=(e,t)=>{$(`#${e} .name`).text(t.name),$(`#${e} .address`).text(t.address),$(`#${e} .category`).text(t.category.name)},fill_finance=(e,t)=>{$(`#${e} .invoices_count`).text(t.length);var i="";already_exist=[],$.each(t,(function(e,t){-1==already_exist.indexOf(t.service.name)&&(i+=`<li>${t.service.name}</li>`)})),$(`#${e} .finance_services`).append(i)},fill_beneficiary=(e,t)=>{$(`#${e} .beneficiary`).text(t.insured.name),$(`#${e} .insured`).text(t.insured.name),$(`#${e} .folder_id`).text(t.identification);var i="";already_exist=[],$.each(t.invoices,(function(e,t){-1==already_exist.indexOf(t.reference)&&(i+=`<li>${t.reference}</li>`)})),$(`#${e} .reference_ids`).append(i)},fill_invoice=(e,t)=>{var i=1,a="";invoices=t.invoices,$(".new-line").data("table",t.code),$(".invoice-table").attr("id",t.code),$.each(invoices,(function(e,t){$.each(t.invoice_lines,(function(e,n){var s=parseInt(n.quantity),d=parseInt(n.price);a+=`<tr id="${n.code}" data-invoice-line="${n.code}"\n    data-description="${n.description}"\n    data-quantity="${s}"\n    data-price="${d}"\n    data-service="${t.service.name}"\n    >\n                        <td>${i++}</td>\n                        <td>${n.description}</td>\n                        <td>${s}</td>\n                        <td>${d}</td>\n                        <td>${d*s}</td>\n                        <td>${t.service.name}</td>\n                        <td>\n\n                          <a class="me-3 edit edit-item blink "\n                              href="#"><i\n                                class="menu-icon mdi mdi-table-edit"></i>\n                          </a>\n\n                          <a id="delete" class="delete delete-item blink" href="#"><i\n                              class="menu-icon mdi mdi-close-circle"></i></a> \n                          <input id="input" type="hidden"\n                            value="">\n                          <div class="blink loader d-none d-flex justify-content-center mt-3">\n\n                          <div class="inner-loading dot-flashing"></div>\n                          </div>\n\n\n                        </td>\n\n                      </tr>`}))})),$(`#${e} .invoice-table tbody`).html(a)};